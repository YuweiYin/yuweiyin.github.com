<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>对 Rust 语言的分析 | YuweiYin</title>
    <meta name="description" content="Homepage of YuweiYin">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/img/YuweiYin.jpeg">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.2d4b740c.css" as="style"><link rel="preload" href="/assets/js/app.21632a1e.js" as="script"><link rel="preload" href="/assets/js/2.5e710586.js" as="script"><link rel="preload" href="/assets/js/281.5cec3906.js" as="script"><link rel="prefetch" href="/assets/js/10.877faa95.js"><link rel="prefetch" href="/assets/js/100.9c63a849.js"><link rel="prefetch" href="/assets/js/101.c24d68bc.js"><link rel="prefetch" href="/assets/js/102.8cfbe5b9.js"><link rel="prefetch" href="/assets/js/103.26cf14f1.js"><link rel="prefetch" href="/assets/js/104.3d0abdbe.js"><link rel="prefetch" href="/assets/js/105.362b96c8.js"><link rel="prefetch" href="/assets/js/106.48ff4913.js"><link rel="prefetch" href="/assets/js/107.e806ad4d.js"><link rel="prefetch" href="/assets/js/108.002b5cd0.js"><link rel="prefetch" href="/assets/js/109.506d13eb.js"><link rel="prefetch" href="/assets/js/11.49690d15.js"><link rel="prefetch" href="/assets/js/110.ab4c14cc.js"><link rel="prefetch" href="/assets/js/111.39b1cad0.js"><link rel="prefetch" href="/assets/js/112.363bc61d.js"><link rel="prefetch" href="/assets/js/113.d99548c5.js"><link rel="prefetch" href="/assets/js/114.4aa1dd26.js"><link rel="prefetch" href="/assets/js/115.3897cba3.js"><link rel="prefetch" href="/assets/js/116.986cd428.js"><link rel="prefetch" href="/assets/js/117.29814796.js"><link rel="prefetch" href="/assets/js/118.c55c999c.js"><link rel="prefetch" href="/assets/js/119.1f08e914.js"><link rel="prefetch" href="/assets/js/12.2dcf81fc.js"><link rel="prefetch" href="/assets/js/120.56aed282.js"><link rel="prefetch" href="/assets/js/121.cfd1f099.js"><link rel="prefetch" href="/assets/js/122.aabd27be.js"><link rel="prefetch" href="/assets/js/123.0c6f4197.js"><link rel="prefetch" href="/assets/js/124.e40b3b3f.js"><link rel="prefetch" href="/assets/js/125.2a876ee7.js"><link rel="prefetch" href="/assets/js/126.80b3b8da.js"><link rel="prefetch" href="/assets/js/127.f376da08.js"><link rel="prefetch" href="/assets/js/128.8e40f5b8.js"><link rel="prefetch" href="/assets/js/129.107324dd.js"><link rel="prefetch" href="/assets/js/13.d016a94b.js"><link rel="prefetch" href="/assets/js/130.e9a04293.js"><link rel="prefetch" href="/assets/js/131.3edda897.js"><link rel="prefetch" href="/assets/js/132.07a13e65.js"><link rel="prefetch" href="/assets/js/133.2f510a09.js"><link rel="prefetch" href="/assets/js/134.db09f803.js"><link rel="prefetch" href="/assets/js/135.0c85fae0.js"><link rel="prefetch" href="/assets/js/136.b2b9b433.js"><link rel="prefetch" href="/assets/js/137.d1fad487.js"><link rel="prefetch" href="/assets/js/138.4210113a.js"><link rel="prefetch" href="/assets/js/139.88325e22.js"><link rel="prefetch" href="/assets/js/14.fcb20a69.js"><link rel="prefetch" href="/assets/js/140.089a0e87.js"><link rel="prefetch" href="/assets/js/141.9a8bf483.js"><link rel="prefetch" href="/assets/js/142.c52f63f4.js"><link rel="prefetch" href="/assets/js/143.e63996c3.js"><link rel="prefetch" href="/assets/js/144.36274ccf.js"><link rel="prefetch" href="/assets/js/145.1b9c2d5c.js"><link rel="prefetch" href="/assets/js/146.200da20a.js"><link rel="prefetch" href="/assets/js/147.a47d1091.js"><link rel="prefetch" href="/assets/js/148.5722aca1.js"><link rel="prefetch" href="/assets/js/149.a9a15445.js"><link rel="prefetch" href="/assets/js/15.13458e44.js"><link rel="prefetch" href="/assets/js/150.4593a711.js"><link rel="prefetch" href="/assets/js/151.cf651532.js"><link rel="prefetch" href="/assets/js/152.86110a92.js"><link rel="prefetch" href="/assets/js/153.803a0b63.js"><link rel="prefetch" href="/assets/js/154.b3fcd5a4.js"><link rel="prefetch" href="/assets/js/155.b82bac8a.js"><link rel="prefetch" href="/assets/js/156.994664e2.js"><link rel="prefetch" href="/assets/js/157.5d602efb.js"><link rel="prefetch" href="/assets/js/158.fb71bf26.js"><link rel="prefetch" href="/assets/js/159.9013945d.js"><link rel="prefetch" href="/assets/js/16.8ca20f87.js"><link rel="prefetch" href="/assets/js/160.1ba344bb.js"><link rel="prefetch" href="/assets/js/161.389d7ff5.js"><link rel="prefetch" href="/assets/js/162.e53c15a6.js"><link rel="prefetch" href="/assets/js/163.513af156.js"><link rel="prefetch" href="/assets/js/164.31035c44.js"><link rel="prefetch" href="/assets/js/165.577e027c.js"><link rel="prefetch" href="/assets/js/166.f53b603e.js"><link rel="prefetch" href="/assets/js/167.8db77aa2.js"><link rel="prefetch" href="/assets/js/168.879cc0c1.js"><link rel="prefetch" href="/assets/js/169.5874b37d.js"><link rel="prefetch" href="/assets/js/17.34def40d.js"><link rel="prefetch" href="/assets/js/170.f05006b8.js"><link rel="prefetch" href="/assets/js/171.f2dfdc30.js"><link rel="prefetch" href="/assets/js/172.d7a52448.js"><link rel="prefetch" href="/assets/js/173.1e8cefd6.js"><link rel="prefetch" href="/assets/js/174.23da8ce6.js"><link rel="prefetch" href="/assets/js/175.e868dae8.js"><link rel="prefetch" href="/assets/js/176.c1679acc.js"><link rel="prefetch" href="/assets/js/177.dda022e9.js"><link rel="prefetch" href="/assets/js/178.cf628deb.js"><link rel="prefetch" href="/assets/js/179.8c5fe8b3.js"><link rel="prefetch" href="/assets/js/18.d748ff12.js"><link rel="prefetch" href="/assets/js/180.7df45456.js"><link rel="prefetch" href="/assets/js/181.a9fa8586.js"><link rel="prefetch" href="/assets/js/182.6458363b.js"><link rel="prefetch" href="/assets/js/183.0a7ba703.js"><link rel="prefetch" href="/assets/js/184.7f2a7ce1.js"><link rel="prefetch" href="/assets/js/185.7a5d2ee7.js"><link rel="prefetch" href="/assets/js/186.47c83c53.js"><link rel="prefetch" href="/assets/js/187.bc0d612b.js"><link rel="prefetch" href="/assets/js/188.ac23b798.js"><link rel="prefetch" href="/assets/js/189.5a412281.js"><link rel="prefetch" href="/assets/js/19.2ee72eaa.js"><link rel="prefetch" href="/assets/js/190.729d6cdf.js"><link rel="prefetch" href="/assets/js/191.e7318c1a.js"><link rel="prefetch" href="/assets/js/192.ff426ed9.js"><link rel="prefetch" href="/assets/js/193.825e6a76.js"><link rel="prefetch" href="/assets/js/194.b84f484e.js"><link rel="prefetch" href="/assets/js/195.08d635d0.js"><link rel="prefetch" href="/assets/js/196.1c6e3459.js"><link rel="prefetch" href="/assets/js/197.fd40b0c3.js"><link rel="prefetch" href="/assets/js/198.eadafd5f.js"><link rel="prefetch" href="/assets/js/199.479e4118.js"><link rel="prefetch" href="/assets/js/20.aee1f501.js"><link rel="prefetch" href="/assets/js/200.60cb37ce.js"><link rel="prefetch" href="/assets/js/201.33d27b1f.js"><link rel="prefetch" href="/assets/js/202.0a31e011.js"><link rel="prefetch" href="/assets/js/203.c39b4f69.js"><link rel="prefetch" href="/assets/js/204.1610fd92.js"><link rel="prefetch" href="/assets/js/205.401e2e1a.js"><link rel="prefetch" href="/assets/js/206.92e7a2f6.js"><link rel="prefetch" href="/assets/js/207.b9f2cb6c.js"><link rel="prefetch" href="/assets/js/208.33c288d3.js"><link rel="prefetch" href="/assets/js/209.aadccc3f.js"><link rel="prefetch" href="/assets/js/21.2bb8d98f.js"><link rel="prefetch" href="/assets/js/210.474cb264.js"><link rel="prefetch" href="/assets/js/211.fad06842.js"><link rel="prefetch" href="/assets/js/212.bc5db856.js"><link rel="prefetch" href="/assets/js/213.3edf60e7.js"><link rel="prefetch" href="/assets/js/214.03404072.js"><link rel="prefetch" href="/assets/js/215.e9179e9c.js"><link rel="prefetch" href="/assets/js/216.d3fb3d62.js"><link rel="prefetch" href="/assets/js/217.6dcbfd38.js"><link rel="prefetch" href="/assets/js/218.d0eb328c.js"><link rel="prefetch" href="/assets/js/219.832113dd.js"><link rel="prefetch" href="/assets/js/22.fe85c967.js"><link rel="prefetch" href="/assets/js/220.05e82d34.js"><link rel="prefetch" href="/assets/js/221.6db1547b.js"><link rel="prefetch" href="/assets/js/222.33dbd616.js"><link rel="prefetch" href="/assets/js/223.e82055cb.js"><link rel="prefetch" href="/assets/js/224.0a291c57.js"><link rel="prefetch" href="/assets/js/225.84d9227d.js"><link rel="prefetch" href="/assets/js/226.d0cba212.js"><link rel="prefetch" href="/assets/js/227.c940c4c7.js"><link rel="prefetch" href="/assets/js/228.bf49f6ae.js"><link rel="prefetch" href="/assets/js/229.24c4715d.js"><link rel="prefetch" href="/assets/js/23.8575cf75.js"><link rel="prefetch" href="/assets/js/230.74314e8f.js"><link rel="prefetch" href="/assets/js/231.bcec3e3a.js"><link rel="prefetch" href="/assets/js/232.a4fd5ba0.js"><link rel="prefetch" href="/assets/js/233.c83a6a99.js"><link rel="prefetch" href="/assets/js/234.ffbaab1f.js"><link rel="prefetch" href="/assets/js/235.ab1f50f7.js"><link rel="prefetch" href="/assets/js/236.d159f32d.js"><link rel="prefetch" href="/assets/js/237.a79fd4c6.js"><link rel="prefetch" href="/assets/js/238.71b14e6c.js"><link rel="prefetch" href="/assets/js/239.56c325e8.js"><link rel="prefetch" href="/assets/js/24.5082f31f.js"><link rel="prefetch" href="/assets/js/240.68c19f1a.js"><link rel="prefetch" href="/assets/js/241.3afc398b.js"><link rel="prefetch" href="/assets/js/242.4e08fb3d.js"><link rel="prefetch" href="/assets/js/243.74fc1c9a.js"><link rel="prefetch" href="/assets/js/244.79e1c3f7.js"><link rel="prefetch" href="/assets/js/245.2233881c.js"><link rel="prefetch" href="/assets/js/246.52a547ab.js"><link rel="prefetch" href="/assets/js/247.049362ac.js"><link rel="prefetch" href="/assets/js/248.3f7a3e97.js"><link rel="prefetch" href="/assets/js/249.3cca8fdd.js"><link rel="prefetch" href="/assets/js/25.9b249ede.js"><link rel="prefetch" href="/assets/js/250.9ee1777b.js"><link rel="prefetch" href="/assets/js/251.1b805f87.js"><link rel="prefetch" href="/assets/js/252.4f5ed2a3.js"><link rel="prefetch" href="/assets/js/253.94901844.js"><link rel="prefetch" href="/assets/js/254.a442aedb.js"><link rel="prefetch" href="/assets/js/255.b878ece3.js"><link rel="prefetch" href="/assets/js/256.1e19a74a.js"><link rel="prefetch" href="/assets/js/257.9304fd71.js"><link rel="prefetch" href="/assets/js/258.2ed26c3b.js"><link rel="prefetch" href="/assets/js/259.3738a3cd.js"><link rel="prefetch" href="/assets/js/26.7d594062.js"><link rel="prefetch" href="/assets/js/260.8a7db5ed.js"><link rel="prefetch" href="/assets/js/261.9af4fca2.js"><link rel="prefetch" href="/assets/js/262.4c2f9125.js"><link rel="prefetch" href="/assets/js/263.104edbf8.js"><link rel="prefetch" href="/assets/js/264.b949d2d0.js"><link rel="prefetch" href="/assets/js/265.87660d6e.js"><link rel="prefetch" href="/assets/js/266.b55ef623.js"><link rel="prefetch" href="/assets/js/267.2e9cf896.js"><link rel="prefetch" href="/assets/js/268.e235b469.js"><link rel="prefetch" href="/assets/js/269.696df585.js"><link rel="prefetch" href="/assets/js/27.3dab15d0.js"><link rel="prefetch" href="/assets/js/270.8aefd715.js"><link rel="prefetch" href="/assets/js/271.b4156daa.js"><link rel="prefetch" href="/assets/js/272.7ca3645f.js"><link rel="prefetch" href="/assets/js/273.79f52c85.js"><link rel="prefetch" href="/assets/js/274.558b403e.js"><link rel="prefetch" href="/assets/js/275.c87badd3.js"><link rel="prefetch" href="/assets/js/276.8459e13c.js"><link rel="prefetch" href="/assets/js/277.5cfcd23d.js"><link rel="prefetch" href="/assets/js/278.30c36133.js"><link rel="prefetch" href="/assets/js/279.1edfe279.js"><link rel="prefetch" href="/assets/js/28.cb82a77a.js"><link rel="prefetch" href="/assets/js/280.cd767b2d.js"><link rel="prefetch" href="/assets/js/282.adef404b.js"><link rel="prefetch" href="/assets/js/283.0b3c498d.js"><link rel="prefetch" href="/assets/js/284.66ea77c7.js"><link rel="prefetch" href="/assets/js/285.bb6b6199.js"><link rel="prefetch" href="/assets/js/286.b07cdfed.js"><link rel="prefetch" href="/assets/js/287.62755945.js"><link rel="prefetch" href="/assets/js/288.fcba5567.js"><link rel="prefetch" href="/assets/js/289.2b66c47a.js"><link rel="prefetch" href="/assets/js/29.e7508caa.js"><link rel="prefetch" href="/assets/js/290.7877dd04.js"><link rel="prefetch" href="/assets/js/291.ac435fd3.js"><link rel="prefetch" href="/assets/js/292.6053c7b0.js"><link rel="prefetch" href="/assets/js/293.d7d8cc8e.js"><link rel="prefetch" href="/assets/js/294.97839ee9.js"><link rel="prefetch" href="/assets/js/295.8d6ae6ce.js"><link rel="prefetch" href="/assets/js/296.520df752.js"><link rel="prefetch" href="/assets/js/297.a77f0a65.js"><link rel="prefetch" href="/assets/js/298.782e3a43.js"><link rel="prefetch" href="/assets/js/299.162fcf0c.js"><link rel="prefetch" href="/assets/js/3.c607decc.js"><link rel="prefetch" href="/assets/js/30.7b469ba2.js"><link rel="prefetch" href="/assets/js/300.c3eae703.js"><link rel="prefetch" href="/assets/js/301.93618721.js"><link rel="prefetch" href="/assets/js/302.45ccba50.js"><link rel="prefetch" href="/assets/js/303.836950c3.js"><link rel="prefetch" href="/assets/js/304.5d16873d.js"><link rel="prefetch" href="/assets/js/305.287ef8d5.js"><link rel="prefetch" href="/assets/js/306.bbcb5a9c.js"><link rel="prefetch" href="/assets/js/307.350d9f5a.js"><link rel="prefetch" href="/assets/js/308.afc7584d.js"><link rel="prefetch" href="/assets/js/309.2011cd6d.js"><link rel="prefetch" href="/assets/js/31.099a9062.js"><link rel="prefetch" href="/assets/js/310.062726b6.js"><link rel="prefetch" href="/assets/js/311.a8b8c18c.js"><link rel="prefetch" href="/assets/js/312.d2243e2e.js"><link rel="prefetch" href="/assets/js/313.ac7f66c6.js"><link rel="prefetch" href="/assets/js/314.fdb6a12a.js"><link rel="prefetch" href="/assets/js/315.6ae84c1c.js"><link rel="prefetch" href="/assets/js/316.91eb2d79.js"><link rel="prefetch" href="/assets/js/317.ef8063e9.js"><link rel="prefetch" href="/assets/js/318.97f4be58.js"><link rel="prefetch" href="/assets/js/319.8f083f54.js"><link rel="prefetch" href="/assets/js/32.048bff68.js"><link rel="prefetch" href="/assets/js/320.dc8538aa.js"><link rel="prefetch" href="/assets/js/321.89df8b9d.js"><link rel="prefetch" href="/assets/js/322.a4fac22d.js"><link rel="prefetch" href="/assets/js/323.8ba1a8c1.js"><link rel="prefetch" href="/assets/js/324.e74daea6.js"><link rel="prefetch" href="/assets/js/325.e88910cf.js"><link rel="prefetch" href="/assets/js/326.648a6b7a.js"><link rel="prefetch" href="/assets/js/327.69252da9.js"><link rel="prefetch" href="/assets/js/328.1ffab9cf.js"><link rel="prefetch" href="/assets/js/329.9863cd92.js"><link rel="prefetch" href="/assets/js/33.c8f14f88.js"><link rel="prefetch" href="/assets/js/330.5c98d28f.js"><link rel="prefetch" href="/assets/js/331.5b161009.js"><link rel="prefetch" href="/assets/js/332.8d8a295e.js"><link rel="prefetch" href="/assets/js/333.e7484e58.js"><link rel="prefetch" href="/assets/js/334.686a4994.js"><link rel="prefetch" href="/assets/js/335.411f3b9e.js"><link rel="prefetch" href="/assets/js/336.2be71199.js"><link rel="prefetch" href="/assets/js/337.550d9b85.js"><link rel="prefetch" href="/assets/js/338.4f246f9c.js"><link rel="prefetch" href="/assets/js/339.a020d8f6.js"><link rel="prefetch" href="/assets/js/34.8a34d988.js"><link rel="prefetch" href="/assets/js/340.3fb6e658.js"><link rel="prefetch" href="/assets/js/35.bd5257e5.js"><link rel="prefetch" href="/assets/js/36.10b30de4.js"><link rel="prefetch" href="/assets/js/37.8b0f1050.js"><link rel="prefetch" href="/assets/js/38.e637498c.js"><link rel="prefetch" href="/assets/js/39.4906c905.js"><link rel="prefetch" href="/assets/js/4.d0b4519a.js"><link rel="prefetch" href="/assets/js/40.5dd56e15.js"><link rel="prefetch" href="/assets/js/41.8fd63255.js"><link rel="prefetch" href="/assets/js/42.cebadd13.js"><link rel="prefetch" href="/assets/js/43.da41e061.js"><link rel="prefetch" href="/assets/js/44.e831a94e.js"><link rel="prefetch" href="/assets/js/45.057c53e5.js"><link rel="prefetch" href="/assets/js/46.1f2526a4.js"><link rel="prefetch" href="/assets/js/47.e4191409.js"><link rel="prefetch" href="/assets/js/48.e80d7336.js"><link rel="prefetch" href="/assets/js/49.0fa7436c.js"><link rel="prefetch" href="/assets/js/5.0463c9b8.js"><link rel="prefetch" href="/assets/js/50.33ad6e25.js"><link rel="prefetch" href="/assets/js/51.09b71e60.js"><link rel="prefetch" href="/assets/js/52.b845aaa7.js"><link rel="prefetch" href="/assets/js/53.5652522e.js"><link rel="prefetch" href="/assets/js/54.3afc1b90.js"><link rel="prefetch" href="/assets/js/55.801dc94a.js"><link rel="prefetch" href="/assets/js/56.94aae014.js"><link rel="prefetch" href="/assets/js/57.f718075e.js"><link rel="prefetch" href="/assets/js/58.650f601a.js"><link rel="prefetch" href="/assets/js/59.1dba56eb.js"><link rel="prefetch" href="/assets/js/6.b8070ad0.js"><link rel="prefetch" href="/assets/js/60.62520294.js"><link rel="prefetch" href="/assets/js/61.055e29dd.js"><link rel="prefetch" href="/assets/js/62.bfba5700.js"><link rel="prefetch" href="/assets/js/63.b5ed4a5d.js"><link rel="prefetch" href="/assets/js/64.469b1ef1.js"><link rel="prefetch" href="/assets/js/65.14018509.js"><link rel="prefetch" href="/assets/js/66.8b2aa73e.js"><link rel="prefetch" href="/assets/js/67.ae36c392.js"><link rel="prefetch" href="/assets/js/68.54b16790.js"><link rel="prefetch" href="/assets/js/69.c26ffb07.js"><link rel="prefetch" href="/assets/js/7.3f1ed5cd.js"><link rel="prefetch" href="/assets/js/70.b5c36b8c.js"><link rel="prefetch" href="/assets/js/71.fb167e4b.js"><link rel="prefetch" href="/assets/js/72.1bc18d14.js"><link rel="prefetch" href="/assets/js/73.0cc99cbf.js"><link rel="prefetch" href="/assets/js/74.75b9e4b6.js"><link rel="prefetch" href="/assets/js/75.ad8e9fd4.js"><link rel="prefetch" href="/assets/js/76.76c446fe.js"><link rel="prefetch" href="/assets/js/77.e3a098e9.js"><link rel="prefetch" href="/assets/js/78.cfb1a3c2.js"><link rel="prefetch" href="/assets/js/79.7341b8bf.js"><link rel="prefetch" href="/assets/js/8.3f0f0d88.js"><link rel="prefetch" href="/assets/js/80.2343c811.js"><link rel="prefetch" href="/assets/js/81.6b944bfe.js"><link rel="prefetch" href="/assets/js/82.b3121246.js"><link rel="prefetch" href="/assets/js/83.8d854d94.js"><link rel="prefetch" href="/assets/js/84.a984745c.js"><link rel="prefetch" href="/assets/js/85.69a7e2ac.js"><link rel="prefetch" href="/assets/js/86.8b49f0bb.js"><link rel="prefetch" href="/assets/js/87.026d9fba.js"><link rel="prefetch" href="/assets/js/88.e8f917ae.js"><link rel="prefetch" href="/assets/js/89.dc70bc8f.js"><link rel="prefetch" href="/assets/js/9.46996e15.js"><link rel="prefetch" href="/assets/js/90.8e8dfe08.js"><link rel="prefetch" href="/assets/js/91.d63134f1.js"><link rel="prefetch" href="/assets/js/92.4150357b.js"><link rel="prefetch" href="/assets/js/93.96ab2605.js"><link rel="prefetch" href="/assets/js/94.34339f6a.js"><link rel="prefetch" href="/assets/js/95.29d4d582.js"><link rel="prefetch" href="/assets/js/96.cc423b40.js"><link rel="prefetch" href="/assets/js/97.ecbb6511.js"><link rel="prefetch" href="/assets/js/98.2d3fc84a.js"><link rel="prefetch" href="/assets/js/99.89474e28.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2d4b740c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YuweiYin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/home/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/article/mathematics/" class="nav-link">
  数学哲学
</a></div><div class="nav-item"><a href="/article/physics/" class="nav-link">
  物理宇宙
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="信息科学" class="dropdown-title"><span class="title">信息科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/article/info-technology/computer-science/" class="nav-link">
  计科基础
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/algorithm/" class="nav-link">
  算法编程
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/artificial-intelligence/" class="nav-link">
  人工智能
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/web-crawler/" class="nav-link">
  网络爬虫
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/web-frontend/" class="nav-link">
  网站前端
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/web-backend/" class="nav-link">
  网站后端
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/web-security/" class="nav-link">
  网络安全
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/system-management/" class="nav-link">
  系统管理
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/other/" class="nav-link">
  其它文章
</a></li></ul></div></div><div class="nav-item"><a href="/article/paper-notes/" class="nav-link">
  论文笔记
</a></div><div class="nav-item"><a href="/article/essay/" class="nav-link">
  见闻随笔
</a></div><div class="nav-item"><a href="/article/other/" class="nav-link">
  其它系列
</a></div><div class="nav-item"><a href="/article/reprint/" class="nav-link router-link-active">
  转载文章
</a></div><div class="nav-item"><a href="https://www.github.com/YuweiYin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/home/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/article/mathematics/" class="nav-link">
  数学哲学
</a></div><div class="nav-item"><a href="/article/physics/" class="nav-link">
  物理宇宙
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="信息科学" class="dropdown-title"><span class="title">信息科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/article/info-technology/computer-science/" class="nav-link">
  计科基础
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/algorithm/" class="nav-link">
  算法编程
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/artificial-intelligence/" class="nav-link">
  人工智能
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/web-crawler/" class="nav-link">
  网络爬虫
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/web-frontend/" class="nav-link">
  网站前端
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/web-backend/" class="nav-link">
  网站后端
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/web-security/" class="nav-link">
  网络安全
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/system-management/" class="nav-link">
  系统管理
</a></li><li class="dropdown-item"><!----> <a href="/article/info-technology/other/" class="nav-link">
  其它文章
</a></li></ul></div></div><div class="nav-item"><a href="/article/paper-notes/" class="nav-link">
  论文笔记
</a></div><div class="nav-item"><a href="/article/essay/" class="nav-link">
  见闻随笔
</a></div><div class="nav-item"><a href="/article/other/" class="nav-link">
  其它系列
</a></div><div class="nav-item"><a href="/article/reprint/" class="nav-link router-link-active">
  转载文章
</a></div><div class="nav-item"><a href="https://www.github.com/YuweiYin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/article/reprint/" class="sidebar-link">转载文章</a></li><li><a href="/article/reprint/yinwang/2012/" class="sidebar-link">王垠 2012 年博客</a></li><li><a href="/article/reprint/yinwang/2013/" class="sidebar-link">王垠 2013 年博客</a></li><li><a href="/article/reprint/yinwang/2014/" class="sidebar-link">王垠 2014 年博客</a></li><li><a href="/article/reprint/yinwang/2015/" class="sidebar-link">王垠 2015 年博客</a></li><li><a href="/article/reprint/yinwang/2016/" class="sidebar-link">王垠 2016 年博客</a></li><li><a href="/article/reprint/yinwang/2017/" class="sidebar-link">王垠 2017 年博客</a></li><li><a href="/article/reprint/yinwang/2018/" class="sidebar-link">王垠 2018 年博客</a></li><li><a href="/article/reprint/yinwang/2019/" class="sidebar-link">王垠 2019 年博客</a></li><li><a href="/article/reprint/yinwang/2020/" class="sidebar-link">王垠 2020 年博客</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="对-rust-语言的分析"><a href="#对-rust-语言的分析" class="header-anchor">#</a> 对 Rust 语言的分析</h1> <p>2016年09月18日 - <a href="http://www.yinwang.org/" target="_blank" rel="noopener noreferrer">王垠<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://www.yinwang.org/blog-cn/2016/09/18/rust" target="_blank" rel="noopener noreferrer">原文链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <hr> <p>Rust 是一门最近比较热的语言，有很多人问过我对 Rust 的看法。由于我本人是一个语言专家，实现过几乎所有的语言特性，所以我不认为任何一种语言是新的。任何“新语言”对我来说，不过是把早已存在的语言特性（或者毛病），挑一些出来放在一起。所以一般情况下我都不会去评论别人设计的语言，甚至懒得看一眼，除非它历史悠久（比如像 C 或者 C++），或者它在工作中惹恼了我（像 Go 和 JavaScript 那样）。这就是为什么这些人问我 Rust 的问题，我一般都没有回复，或者一笔带过。</p> <p>不过最近有点闲，我想既然有人这么热衷于这种新语言，那我还是稍微凑下热闹，顺便分享一下我对某些常见的设计思路的看法。所以这篇文章虽然是在评论 Rust 的设计，它却不只是针对 Rust。它是针对某些语言特性，而不只是针对某一种语言。</p> <p>由于我这人性格很难闭门造车，所以现在我只是把这篇文章的开头发布出来，边写边更新。所以你要明白，这只是一个开端，我会按自己理解的进度对这篇文章进行更新。你看了之后，可以隔一段时间再回来看新的内容。如果有特别疑惑的问题，也可以发信来问，我会汇总之后把看法发布在这里。</p> <h2 id="变量声明语法"><a href="#变量声明语法" class="header-anchor">#</a> 变量声明语法</h2> <p>Rust 的<a href="https://doc.rust-lang.org/book/variable-bindings.html" target="_blank" rel="noopener noreferrer">变量声明<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>跟 Scala 和 Swift 的很像。你用</p> <p><code>let x = 8;</code></p> <p>这样的构造来声明一个新的变量。大部分时候 Rust 可以推导出变量的类型，所以你不一定需要写明它的类型。如果你真的要指明变量类型，需要这样写：</p> <p><code>let x: i32 = 8;</code></p> <p>在我看来这是丑陋的语法。本来语义是把变量 x 绑定到值 8，可是 x 和 8 之间却隔着一个“i32”，看起来像是把 8 赋值给了 i32……</p> <p>变量缺省都是不可变的，也就是不可赋值。你必须用一种特殊的构造</p> <p><code>let mut x = 8;</code></p> <p>来声明可变变量。这跟 Swift/Scala 的 let 和 var 的区别是一样的，只是形式不大一样。</p> <h2 id="变量可以重复绑定"><a href="#变量可以重复绑定" class="header-anchor">#</a> 变量可以重复绑定</h2> <p>Rust 的变量定义有一个比其它语言更奇怪的地方，它可以让你在同一个作用域里面“重复绑定”同一个名字，甚至可以把它绑定到另外一个类型：</p> <div class="language- extra-class"><pre class="language-text"><code>let mut x: i32 = 1;
x = 7;
let x = x; // 这两个 x 是两个不同的变量

let y = 4;
// 30 lines of code ...
let y = &quot;I can also be bound to text!&quot;;
// 30 lines of code ...
println!(&quot;y is {}&quot;, y);      // 定义在第二个 let y 的地方
</code></pre></div><p>在 Yin 语言最初的设计里面，我也是允许这样的重复绑定的。第一个 y 和 第二个 y 是两个不同的变量，只不过它们碰巧叫同一个名字而已。你甚至可以在同一行出现两个 x，而它们其实是不同的变量！这难道不是一个很酷，很灵活，其他语言都没有的设计吗？后来我发现，虽然这实现起来没什么难度，可是这样做不但没有带来更大的方便性，反而可能引起程序的混淆不清。在同一个作用域里面，给两个不同的变量起同一个名字，这有什么用处呢？自找麻烦而已。</p> <p>比如上面的例子，在下面我们看到一个对变量 y 的引用，它是在哪里定义的呢？你需要在头脑中对程序进行“数据流分析”，才能找到它定义的位置。从上面读起，我们看到 let y = 4，然而这不一定是正确的定义，因为 y 可以被重新绑定，所以我们必须继续往下看。30 行代码之后，我们看到了第二个对 y 的绑定，可是我们仍然不能确定。继续往下扫，30行代码之后我们到了引用 y 的地方，没有再看到其它对 y 的绑定，所以我们才能确信第二个 let 是 y 的定义位置，它是一个字符串。</p> <p>这难道不是很费事吗？更糟的是，这种人工扫描不是一次性的工作，每次看到这个变量，你都要疑惑一下它是什么东西，因为它可以被重新绑定，你必须重新确定一下它的定义。如果语言不允许在同一个作用域里面重复绑定同一个名字，你就根本不需要担心这个事情了。你只需要在作用域里面找到唯一的那个 let y = ...，那就是它的定义。</p> <p>也许你会说，只有当有人滥用这个特性的时候，才会导致问题。然而语言设计的问题往往就在于，一旦你允许某种奇葩的用法，就一定会有人自作聪明去用。因为你无法确信别人是否会那样做，所以你随时都得提高警惕，而不能放松下心情来。</p> <h2 id="类型推导"><a href="#类型推导" class="header-anchor">#</a> 类型推导</h2> <p>另外一个很多人误解的地方是类型推导。在 Rust 和 C# 之类的语言里面，你不需要像 Java 那样写</p> <p><code>int x = 8;</code></p> <p>这样显式的指出变量的类型，而是可以让编译器把类型推导出来。比如你写：</p> <p><code>let x = 8; // x 的类型推导为 i32</code></p> <p>编译器的类型推导就可以知道 x 的类型是 i32，而不需要你把“i32”写在那里。这似乎是一个很方便的东西。然而看过很多 C# 代码之后你发现，这看似方便，却让程序变得不好读。在看 C# 代码的时候，我经常看到一堆的变量定义，每一个的前面都是 var。我没法一眼就看出它们表示什么，是整数，bool，还是字符串，还是某个用户定义的类？</p> <div class="language- extra-class"><pre class="language-text"><code>var correct = ...;
var id = ...;
var slot = ...;
var user = ...;
var passwd = ...;
</code></pre></div><p>我需要把鼠标移到变量上面，让 Visual Studio 显示出它推导出来的类型，可是鼠标移开之后，我可能又忘了它是什么。有时候发现看同一片代码，都需要反复的做这件事，鼠标移来移去的。而且要是没有 Visual Studio，用其它编辑器，或者在 github 上看代码或者 code review 的时候，你就得不到这种信息了。很多 C# 程序员为了避免这个问题，开始用很长的变量名，把类型的名字加在变量名字里面去，这样一来反而更复杂了，却没有想到直接把类型写出来。所以这种形式的类型推导，看似先进或者方便，其实还不如直接在声明处写下变量的类型，就像 Java 那样。</p> <p>所以，虽然 Rust 在变量声明上似乎有更灵活的设计，然而我觉得 C 和 Java 之类的语言那样看似死板的方式其实更好。我建议不要使用 Rust 变量的重复绑定，避免使用类型推导，尽量明确的写出类型，以方便读者。如果你真的在乎代码的质量，就会发现大部分时候你的代码的读者是你自己，而不是别人，因为你需要反复的阅读和提炼你的代码。</p> <h2 id="动作的-返回值"><a href="#动作的-返回值" class="header-anchor">#</a> 动作的“返回值”</h2> <p>Rust 的文档说它是一种“大部分基于表达式”的语言，并且给出这样一个例子：</p> <div class="language- extra-class"><pre class="language-text"><code>let mut y = 5;
let x = (y = 6);  // x has the value `()`, not `6`
</code></pre></div><p>奇怪的是，这里变量 x 会得到一个值，空的 tuple，()。这种思路不大对，它是从像 OCaml 那样的语言照搬过来的，而 OCaml 本身就有问题。在 OCaml 里面，如果你使用 print_string，那你会得到如下的结果：</p> <div class="language- extra-class"><pre class="language-text"><code>print_string &quot;hello world!\n&quot;;;
    	 	
hello world!
- : unit = ()
</code></pre></div><p>这里，print_string 是一个“动作”，它对应过程式语言里面的“statement”。就像 C 语言的 printf。动作通常只产生“副作用”，而不返回值。在 OCaml 里面，为了“理论的优雅”，动作也会返回一个值，这个值叫做 ()。其实 () 相当于 C 语言的 void。C 语言里面有 void 类型，然而它却不允许你声明一个 void 类型的变量。比如你写</p> <div class="language- extra-class"><pre class="language-text"><code>int main()
{
  void x;
}
</code></pre></div><p>程序是没法编译通过的（试一试？）。让人惊讶的是，古老的 C 的做法其实是正确的，这里有比较深入的原因。如果你把一个类型看成是一个集合（比如 int 是机器整数的集合），那么 void 所表示的集合是个空集，它里面是不含有任何元素的。声明一个 void 类型的变量是没有任何意义的，因为它不可能有一个值。如果一个函数返回 void，你是没法把它赋值给一个变量的。</p> <p>可是在 Rust 里面，不但动作（比如 y = 6 ）会返回一个值 ()，你居然可以把这个值赋给一个变量。其实这是错误的作法。原因在于 y = 6 只是一个“动作”，它只是把 6 放进变量 y 里面，这个动作发生了就发生了，它根本不应该返回一个值，它不应该可以出现在 let x = (y = 6); 的右边。就算你牵强附会说 y = 6 的返回值是 ()，这个值是没有任何用处的。更不要说使用空的 tuple 来表示这个值，会引起更大的类型混淆，因为 () 本身有另外的，更有用的含义。</p> <p>你根本就不应该可以写 let x = (y = 6); 这样的代码。只有当你犯错误或者逻辑不清晰的时候，才有可能把 y = 6 当成一个值来用。Rust 允许你把这种毫无意义的返回值赋给一个变量，这种错误就没有被及时发现，反而能够通过变量传播到另外一个地方去。有时候这种错误会传播挺远，然后导致问题（运行时错误或者类型检查错误），可是当它出问题的时候，你就不大容易找到错误的起源了。</p> <p>这是很多语言的通病，特别是像 JavaScript 或者 PHP 之类的语言。它们把毫无意义或者牵强附会的结果（比如 undefined）到处传播，结果使错误很难被发现和追踪。</p> <h2 id="return-语句"><a href="#return-语句" class="header-anchor">#</a> return 语句</h2> <p>Rust 的设计者似乎很推崇“面向表达式”的语言，所以在 Rust 里面你不需要直接写“return”这个语句。比如，这个例子里面，你可以直接这样写：</p> <div class="language- extra-class"><pre class="language-text"><code>fn add_one(x: i32) -&gt; i32 {
    x + 1
}
</code></pre></div><p>返回函数里的最后一个表达式，而不需要写 return 语句，这是函数式语言共有的特征。然而其实我觉得直接写 return 其实是更好的作法，像这个样子：</p> <div class="language- extra-class"><pre class="language-text"><code>fn foo(x: i32) -&gt; i32 {
    return x + 1;
}
</code></pre></div><p>编程有一个容易引起问题的作法，叫做“不够明确”，总想让编译器自动去处理一些问题，在这里也是一样的问题。如果你隐性的返回函数里最后一个表达式，那么每一次看见这个函数，你都必须去搞清楚最后一个表达式是什么，这并不是每次都那么明显的。比如下面这段代码：</p> <div class="language- extra-class"><pre class="language-text"><code>fn main() {
    println!(&quot;{}&quot;, add_one(7));
}

fn add_one(x: i32) -&gt; i32 {
  if (x &lt; 5) {
      if (x &lt; 10) {
        // 做很多事...
        x * 2
      } else {
        // 做很多事...
        x + 1
      }
  } else {
    // 做很多事...
    x / 2
  }
}
</code></pre></div><p>由于 if 语句里面有嵌套，每个分支又有好些代码，而且 if 语句又是最后一个语句，所以这个嵌套 if 的三个出口的最后一个表达式都是返回值。如果你写了“return”，那么你可以直接看有几个“return”，或者拿编辑器加亮一下，就知道这个函数有几个出口。然而现在没有了“return”这个关键字，你就必须把最后那个 if 语句自己看清楚了，找到每一个分支的“最后表达式”。很多时候这不是那么明显，你总需要找一下，而且这件事在读代码的时候总是反复做。</p> <p>所以对于返回值，我的建议是总是明确的写上“return”，就像第二个例子那样。Rust 的文档说这是“poor style”，那不是真的。有一个例外，那就是当函数体里面只有一条语句的时候，那个时候没有任何歧义哪一个是返回表达式。</p> <p>这个问题类似于重复绑定变量和类型推导的问题，属于一种“用户体验设计”问题。无论如何，编译器都很容易实现，然而不同样式的代码，对于人类阅读的工作量，是很不一样的。很多时候最省人力的做法并不是那种看来最聪明，最酷，打字量最少的办法，而是写得最明确，让读者省事的办法。人们常说，代码读的时候比写的时候多得多，所以要想语言好用省事，我们应该更加重视读的时候，而不是写的时候。</p> <h2 id="数组的可变性"><a href="#数组的可变性" class="header-anchor">#</a> 数组的可变性</h2> <p>Rust 的数组可变性标记，跟 Swift 犯了一样的错误。Swift 的问题，我已经在之前的文章有详细叙述，所以这里就不多说了。简言之，同一个标记能表示的可变性，要么针对数组指针，要么针对数组元素，应该只能选择其一。而在 Rust 里面，你只有一个地方可以放“mut”进去，所以要么数组指针和元素全部都可变，要么数组指针和元素都不可变。你没有办法制定一个不可变的数组指针，而它指向的数组的元素却是可变的。</p> <p>请对比下面两个例子：</p> <div class="language- extra-class"><pre class="language-text"><code>fn main() {
    let m = [1, 2, 3];      // 指针和元素都不可变
    m[0] = 10;              // 出错
    m = [4, 5, 6];          // 也出错
}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>fn main() {
    let mut m = [1, 2, 3];  // 指针和元素都可变
    m[0] = 10;              // 不出错
    m = [4, 5, 6];          // 也不出错
}
</code></pre></div><h2 id="内存管理"><a href="#内存管理" class="header-anchor">#</a> 内存管理</h2> <p>Rust 号称实现了非常先进的内存管理机制，不需要垃圾回收（GC）或者引用计数（RC）就可以“静态”的管理内存的分配和释放。然而仔细思考之后你就会发现，这很可能是不切实际的梦想（或者广告）。内存的分配和释放（如果要及时释放的话），本身是一个动态的过程，无法用静态分析来实现。现在你说可以通过一些特殊的构造，特殊的指针和传值方式，静态的决定内存的回收时间，真的有可能吗？</p> <p>实际上我有一个类似的梦。我曾经向我的教授们提出过 N 多种不需 GC 和 RC 就能静态管理内存的办法，结果每一次都被他们给我的小例子给打败了，以至于我很难相信有任何人可以想到比 GC 和 RC 更好的方法。</p> <p>Rust 那些炫酷的 move semantics, borrowing, lifetime 之类的概念加在一起，不但让语言变得复杂不堪，我感觉并不能从根本上解决内存管理问题。很多人在 blog 里面为这些概念热情洋溢地做宣传，显得自己很懂一样，拿一些玩具代码来演示，可是从没看到任何人说清楚这些东西为什么可以从根本上解决问题，能用到复杂一点的代码里面去。所以我觉得这些东西有“皇帝的新装”之嫌。</p> <p>连 Rust 自己的<a href="https://doc.rust-lang.org/book/ownership.html#meta" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>都说，你可能需要“fight with the borrow checker”。为了通过这些检查，你必须用很怪异的方式来写程序，随着问题复杂度的增加，就要求有更怪异的写法。如果用了 lifetime，很简单一个代码看起来就会是这种样子。真够烦的，我感觉我的眼睛都没法 parse 这段代码了。</p> <div class="language- extra-class"><pre class="language-text"><code>fn foo&lt;'a, 'b&gt;(x: &amp;'a str, y: &amp;'b str) -&gt; &amp;'a str {
}
</code></pre></div><p>上一次我看 Rust 文档的时候，没发现有 lifetime 这概念。文档对此的介绍非常粗略，仔细看了也不知道他们在说些什么，更不要说相信这办法真的管用了。对不起，我根本不想去理解这些尖括号里的 'a 和 'b 是什么，除非你先向我证明这些东西真的能解决内存管理的问题。实际上这个 lifetime 我感觉像是跨过程静态分析时产生的一些标记，要知道静态分析是无法解决内存管理的问题的，我猜想这种 lifetime 在有递归函数的情况下就会遇到麻烦。</p> <p>实际上我最开头看 Rust 的时候，它号称只用 move semantics 和好几种不同的指针，就可以解决内存管理的问题。可是一旦有了那几种不同的指针，就已经复杂不堪了，比 C 语言还要麻烦，而且显然不能解决问题。Lifetime 恐怕是后来发现有新的问题解决不了才加进去的，可是我不知道他们这次是不是又少考虑了某些情况。</p> <p>Rust 的设计者显然受了 <a href="https://en.wikipedia.org/wiki/Linear_logic" target="_blank" rel="noopener noreferrer">Linear Logic<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 一类看似很酷的逻辑的启发和熏陶，想用类似的方式奇迹般的解决内存和资源的回收问题。然而研究过一阵子 Linear Logic 之后我发现，这个逻辑自己都没有解决任何问题，只不过给对象的引用方式施加了一些无端的限制，这样使得对象的引用计数是一个固定的值（1）。内存管理当然容易了，可是这样导致有很多程序你没法表达。</p> <p>开头让你感觉很有意思，似乎能解决一些小问题。到后来遇到大一点的实际问题的时候，你就发现需要引入越来越复杂的概念，使用越来越奇葩的写法，才能达到目的，而且你总是会在将来某个时候发现它没法解决的问题。因为这个问题很可能从根本上是无法解决的，所以每当遇到有超越现有能力的事情，你就得增加新的“绕过方法”（workaround）。缝缝补补，破败不堪。最后你发现，除了垃圾回收（GC）和引用计数（RC），内存管理还是没有其它更好更简单的办法。</p> <p>当然我的意见也许不是完全准确，可我真是没有时间去琢磨这么多乱七八糟，不知道管不管用的概念（特别是 lifetime），更不要说真的用它来构建大型的系统程序了。有用来理解这些概念，把程序改成奇葩样子的时间，我可能已经用 C 语言写出很好的手动内存管理代码了。如果你真的看进去理解了，发现这些东西可以用的话，告诉我一声！不过你必须说明原因，不要只告诉我“皇帝是穿了衣服的” 😛</p> <h2 id="完"><a href="#完" class="header-anchor">#</a> 完</h2> <p>本来想写一个更详细的评价的，可是到了这个地方，我感觉已经失去兴趣了，困就一个字啊…… Rust 比 C 语言复杂太多，我很难想象用这样的语言来构造大型的操作系统。而构造系统程序，是 Rust 设计的初衷。说真的，写操作系统那样的程序，C 语言真的不算讨厌。用户空间的程序，Java，C# 和 Swift 完全可以胜任。所以我觉得 Rust 的市场空间恐怕非常狭小……</p> <p>（如果你喜欢这些内容，请付费<a href="http://www.yinwang.org/blog-cn/2016/04/13/pay-blog" target="_blank" rel="noopener noreferrer">5美元或者30人民币<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，谢谢！）</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.21632a1e.js" defer></script><script src="/assets/js/2.5e710586.js" defer></script><script src="/assets/js/281.5cec3906.js" defer></script>
  </body>
</html>
